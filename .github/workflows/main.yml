name: Advanced AI Tech Assistant

on:
  push:
    branches: [ main ]
  workflow_dispatch:
    inputs:
      task_type:
        description: 'Select Task'
        required: true
        default: 'Refactor'
        type: choice
        options:
          - Refactor
          - Bug Fix
          - New Feature
          - Security Audit
          - Documentation
      custom_prompt:
        description: 'Detailed Instructions'
        required: false
      auto_commit:
        description: 'Apply changes directly'
        type: boolean
        default: false

permissions:
  contents: write
  pull-requests: write
  issues: write

jobs:
  smart-dev:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: AI Processing
        id: gemini
        uses: google-github-actions/run-ai-chat@v0
        with:
          google_api_key: ${{ secrets.GEMINI_API_KEY }}
          prompt: |
            Context: RockDeals POS System
            Task: ${{ github.event.inputs.task_type }}
            Instructions: ${{ github.event.inputs.custom_prompt }}
            Action: Improve code quality, follow PEP8, and optimize performance.

      - name: Create Pull Request
        if: github.event.inputs.auto_commit == 'false'
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: AI generated improvements
          title: "AI Optimization: ${{ github.event.inputs.task_type }}"
          body: "This PR was generated by Gemini AI based on your request."
          branch: ai-updates
